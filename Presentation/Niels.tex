%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Niels %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%
\section{State Space}

%---------------------------------------------------------------------------------
\subsection{Motivation}%----------------------------------------------------------
%---------------------------------------------------------------------------------
\begin{frame}{State Space}{Motivation}
  \begin{itemize}
    \item Control of velocity for improved performance
    \item Classical cascade control is not feasible
  \end{itemize}
  %
  \begin{figure}[H]
    \centering
    \input{Pictures/plantWithCascade.tikz}
  \end{figure}
\end{frame}

%---------------------------------------------------------------------------------
\subsection{Model}%---------------------------------------------------------------
%---------------------------------------------------------------------------------

\begin{frame}{State Space}{Model}

%  \only<2>
%  {  
%  \tikz[overlay,xshift=12.75em,yshift=10ex]{\draw node [fontscale=\footnotesize]{
%              \si{\ddot{\theta}_F = -\frac{B_F}{J_F + m_w \cdot {l_w}^2} \cdot \dot{\theta}_F + \frac{(m_F \cdot l_F + m_w \cdot l_w) \cdot g}{J_F + m_w \cdot {l_w}^2} \cdot sin(\theta_F)}
%              };}
%  \tikz[overlay,xshift=12em,yshift=6.3ex]{\draw node [fontscale=\footnotesize]{
%               \si{- \frac{1}{J_F + m_w \cdot {l_w}^2} \cdot \tau_m + \frac{B_w}{J_F + m_w \cdot {l_w}^2} \cdot \dot{\theta}_w}
%               };}
%  \tikz[overlay,xshift=12.7em,yshift=0ex]{\draw node [fontscale=\footnotesize]{
%                \si{\ddot{\theta}_w = \frac{J_w+J_F+m_w \cdot {l_w}^{2}}{J_w \cdot (J_F+m_w \cdot {l_w}^{2})} \cdot \tau_m - \frac{(J_w+J_F+{l_w}^{2} \cdot m_w) \cdot B_w}{J_w \cdot (J_F+m_w \cdot  {l_w}^2)} \cdot \dot{\theta}_w}
%              };}
%  \tikz[overlay,xshift=12.93em,yshift=-4ex]{\draw node [fontscale=\footnotesize]{
%                \si{- \frac{(m_F \cdot l_F + m_w \cdot l_w) \cdot g}{J_F+m_w \cdot {l_w}^{2}} \cdot sin(\theta_F) + \frac{B_F}{J_F+m_w \cdot {l_w}^{2}} \cdot \dot{\theta}_F}
%           };}
%         
%  }

  \only<2>
  {  
  \tikz[overlay,xshift=12em,yshift=12ex]{\draw node [fontscale=\footnotesize]{
              \si{\ddot{\theta}_F = -\frac{B_F}{J_F + m_w \cdot {l_w}^2} \cdot \dot{\theta}_F + \frac{(m_F \cdot l_F + m_w \cdot l_w) \cdot g}{J_F + m_w \cdot {l_w}^2} \cdot \theta_F}
              };}
  \tikz[overlay,xshift=12em,yshift=8.3ex]{\draw node [fontscale=\footnotesize]{
               \si{- \frac{1}{J_F + m_w \cdot {l_w}^2} \cdot \tau_m + \frac{B_w}{J_F + m_w \cdot {l_w}^2} \cdot \dot{\theta}_w}
               };}
  \tikz[overlay,xshift=12.7em,yshift=3ex]{\draw node [fontscale=\footnotesize]{
                \si{\ddot{\theta}_w = \frac{J_w+J_F+m_w \cdot {l_w}^{2}}{J_w \cdot (J_F+m_w \cdot {l_w}^{2})} \cdot \tau_m - \frac{(J_w+J_F+{l_w}^{2} \cdot m_w) \cdot B_w}{J_w \cdot (J_F+m_w \cdot  {l_w}^2)} \cdot \dot{\theta}_w}
              };}
  \tikz[overlay,xshift=12.2em,yshift=-1ex]{\draw node [fontscale=\footnotesize]{
                \si{- \frac{(m_F \cdot l_F + m_w \cdot l_w) \cdot g}{J_F+m_w \cdot {l_w}^{2}} \cdot \theta_F + \frac{B_F}{J_F+m_w \cdot {l_w}^{2}} \cdot \dot{\theta}_F}
           };}
         
  }

  \only<1>
        {
        \tikz[overlay,xshift=8em,yshift=6ex]{\draw node {
          \begin{minipage}{0.01\linewidth}
          	  \begin{flalign}
          	  	& \hspace{1 cm} \si{\vec{\dot{x}}(t) =\ } \si{ \vec{A} \cdot \vec{x}(t) + \vec{B} \cdot \vec{u}(t)} \nonumber \\
          	  	& \hspace{1 cm} \si{\vec{y}(t) =\ } \si{ \vec{C} \cdot \vec{x}(t) + \vec{D} \cdot \vec{u}(t)} \nonumber
          	  \end{flalign}
          \end{minipage}
          };}
      }
      
\only<1-2>{
  \tikz[overlay,xshift=13.5em,yshift=-8ex]{\draw node {
      \input{Pictures/SSBlockDiagram.tikz}
  };}
  \tikz[overlay,xshift=11em,yshift=-17ex]{\draw node {
      \begin{minipage}{0.01\linewidth}
       	\begin{flalign}
       		\vec{x} = 
       		\begin{bmatrix}
       			\theta_F \\
       			\dot{\theta}_F \\ 
       			\dot{\theta}_w \\
       		\end{bmatrix}	\textbf{,}\ \nonumber
       	\end{flalign}  
      \end{minipage}
      %\hspace{0.03\linewidth}
      \begin{minipage}{0.01\linewidth}
       	\begin{flalign}
       		\vec{y} = 
       		\begin{bmatrix}
       			\theta_F \\
       			\dot{\theta}_w \\
       		\end{bmatrix}	\textbf{,}\ \nonumber
       	\end{flalign}
      \end{minipage}
      %\hspace{0.03\linewidth}
      \begin{minipage}{0.01\linewidth}
       	\begin{flalign}
       		\vec{u}= 
       		\begin{bmatrix}
       			\tau_m\\
       		\end{bmatrix}	\nonumber
       	\end{flalign}
    \end{minipage}
  };}
}   
\end{frame}

%---------------------------------------------------------------------------------
\subsection{Controller Design}%---------------------------------------------------
%---------------------------------------------------------------------------------
\begin{frame}{State Space}{Controller Design}
  \begin{itemize}
    \item Eigenvalues of \si{A - BK}
    \item Pole placement
  \end{itemize}

  \begin{displaymath}
  	\hspace{-5cm}\si{\vec{\dot{x}}(\vec{t}) = (\vec{A}-\vec{B}\vec{K}) \cdot \vec{x}(\vec{t})} \nonumber
  \end{displaymath}
  
  \begin{figure}[H]
      \centering
      \input{Pictures/SSBlockDiagramFeedback.tikz}
  \end{figure}
\end{frame}

%---------------------------------------------------------------------------------
\subsection{Controller Analysis}%-------------------------------------------------
%---------------------------------------------------------------------------------
\begin{frame}{State Space}{Controller Analysis}
  \begin{itemize}
    \item Controller reacting to disturbance
    \item Different pole placements
  \end{itemize}
  \vspace{1cm}
  \hspace{0.03\linewidth}
  \begin{minipage}{\linewidth}
   	\begin{minipage}{0.45\linewidth}
   		\begin{figure}[H]
   			\includegraphics[scale=.35]{Pictures/disturbanceStateSpace}
   			\centering
   		\end{figure}
   	\end{minipage}
   	\hspace{0.03\linewidth}
   	\begin{minipage}{0.45\linewidth}
   		\begin{figure}[H]
   			\includegraphics[scale=.35]{Pictures/disturbanceStateSpaceWheel}
   			\centering
   		\end{figure}
   	\end{minipage}
  \end{minipage}
\end{frame}

\begin{frame}{State Space}{Controller Analysis}
  \begin{itemize}
    \item Catching responses
    \item The yellow was chosen
  \end{itemize}
  %
  \vspace{1cm}
  \hspace{0.03\linewidth}
  \begin{minipage}{\linewidth}
  	\begin{minipage}{0.45\linewidth}
  		\begin{figure}[H]
  			\includegraphics[scale=.35]{Pictures/catchingStateSpace}
  			\centering
  		\end{figure}
  	\end{minipage}
  	\hspace{0.03\linewidth}
  	\begin{minipage}{0.45\linewidth}
  		\begin{figure}[H]
  			\includegraphics[scale=.35]{Pictures/catchingStateSpaceWheel}
  			\centering
  		\end{figure}
  	\end{minipage}
  \end{minipage}
\end{frame}

\begin{frame}{State Space}{Controller Analysis}
  \begin{itemize}
    \item The velocity is controlled to zero
  \end{itemize}

  \vspace{1cm}
  \hspace{1\linewidth}
  \begin{minipage}{\linewidth}
   	\begin{minipage}{0.45\linewidth}
   		\begin{figure}[H]
   			\includegraphics[scale=.35]{Pictures/positionSSTest}
   			\centering
   		\end{figure}
   	\end{minipage}
   	\hspace{0.03\linewidth}
   	\begin{minipage}{0.45\linewidth}
   		\begin{figure}[H]
   			\includegraphics[scale=.35]{Pictures/wheelSSTest}
   			\centering
   		\end{figure}
   	\end{minipage}
  \end{minipage}
\end{frame}
